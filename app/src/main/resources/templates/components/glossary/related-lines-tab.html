<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<body>
<!-- Related Lines Tab -->
<div th:fragment="div" th:remove="tag">
    <div x-show="glossaryConfigTabs.activeTab === 'lines'">
        <div class="flex items-end gap-2 px-4">
            <div class="flex-1">
                <label :for="`lineSearch${index}`" class="text-xs text-gray-400 block mb-1">Search</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-2 pointer-events-none">
                        <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-linecap="round"
                                  stroke-linejoin="round" stroke-width="2"/>
                        </svg>
                    </div>
                    <input @input.debounce.300ms="fetchRelatedLines(glossary)"
                           class="pl-7 pr-2 py-1.5 w-full text-sm border border-gray-200 rounded focus:ring-1 focus:ring-blue-400 focus:border-blue-400"
                           id="`lineSearch${index}`" placeholder="Enter search term..." type="text"
                           x-model="glossary.details.lineSearchTerm">
                </div>
            </div>

            <!-- Search Options -->
            <div class="flex items-center space-x-1 mb-1">
                <button
                        :class="{ 'bg-blue-500 text-white': glossaryConfigTabs.lineMatchCase, 'bg-gray-100 text-gray-600 hover:bg-gray-200': !glossaryConfigTabs.lineMatchCase }"
                        @click="glossaryConfigTabs.lineMatchCase = !glossaryConfigTabs.lineMatchCase; changeValue('glossaryConfigTabs', glossaryConfigTabs); fetchRelatedLines(glossary)"
                        class="px-2 py-1.5 text-xs font-medium rounded focus:outline-none focus:ring-1 focus:ring-blue-400"
                        title="Match Case">
                    Aa
                </button>
                <button
                        :class="{ 'bg-blue-500 text-white': glossaryConfigTabs.lineMatchWholeWord, 'bg-gray-100 text-gray-600 hover:bg-gray-200': !glossaryConfigTabs.lineMatchWholeWord }"
                        @click="glossaryConfigTabs.lineMatchWholeWord = !glossaryConfigTabs.lineMatchWholeWord; changeValue('glossaryConfigTabs', glossaryConfigTabs); fetchRelatedLines(glossary)"
                        class="px-2 py-1.5 text-xs font-medium rounded focus:outline-none focus:ring-1 focus:ring-blue-400"
                        title="Match Whole Word">
                    W
                </button>
                <button
                        :class="{ 'bg-blue-500 text-white': glossaryConfigTabs.lineUseRegex, 'bg-gray-100 text-gray-600 hover:bg-gray-200': !glossaryConfigTabs.lineUseRegex }"
                        @click="glossaryConfigTabs.lineUseRegex = !glossaryConfigTabs.lineUseRegex; changeValue('glossaryConfigTabs', glossaryConfigTabs); fetchRelatedLines(glossary)"
                        class="px-2 py-1.5 text-xs font-medium rounded focus:outline-none focus:ring-1 focus:ring-blue-400"
                        title="Use Regular Expression">
                    .*
                </button>
            </div>

            <a :href="`/chapters?chapterId=${glossary.chapterId}&lineSearchQuery=${glossary.details.lineSearchTerm}`"
               class="bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium rounded px-4 py-1.5 mb-1 transition duration-150">
                Open in Chapter Editor
            </a>
        </div>

        <template x-if="glossary.details.loadingLines">
            <div class="flex justify-center items-center h-40 py-5">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
            </div>
        </template>

        <!-- Related Lines Panel -->
        <div
                x-show="!glossary.details.loadingLines && glossary?.details?.relatedLines && glossary?.details?.relatedLines?.length > 0">
            <ul class="divide-y divide-gray-200">
                <template :key="line.id" x-for="(line, index) in glossary?.details?.relatedLines">
                    <li class="py-4 hover:bg-gray-50 transition duration-150 rounded-lg">
                        <!-- View Mode -->
                        <div class="relative px-4">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center">
                                    <a class="inline-flex items-center gap-2 p-1 bg-gray-100 rounded text-gray-500 hover:text-blue-700 font-medium mr-2"
                                       href="#"
                                       x-bind:href="`/chapters?chapterId=${line?.chapterId}&lineNumber=${line.lineIndex}`">
                                            <span class="text-xs font-medium px-2 py-1"
                                                  x-text="`Line #${line.lineIndex} | Ch. ${line.number}`">
                                                Line #1 | Ch. 2`
                                            </span>

                                        <svg fill="none" height="16" viewBox="0 0 24 24" width="16"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                                                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                                    stroke-width="2"/>
                                        </svg>
                                    </a>
                                    <span class="text-xs text-gray-300 hover:text-gray-500"
                                          x-text="`Item #${index + 1} | ID: ${line.id}`">
                                            Item #2 | ID: 123
                                        </span>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <div class="flex items-center mb-1">
                                        <span class="text-xs font-medium text-gray-500">Original</span>
                                        <span
                                                class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800"
                                                x-show="!line.originalLine">
                                                Missing
                                            </span>
                                    </div>
                                    <p :class="!line.originalLine ? 'border-red-300 bg-red-50 italic text-red-500' : 'border-gray-200 text-gray-700'"
                                       class="text-sm p-2 rounded-lg border">
                                        <span x-text="line?.originalLine || 'No original text'"></span>
                                    </p>
                                </div>
                                <div>
                                    <div class="flex items-center mb-1">
                                        <span class="text-xs font-medium text-gray-500">Translation</span>
                                        <span
                                                class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800"
                                                x-show="!line.translatedLine">
                                                Missing
                                            </span>
                                    </div>
                                    <p :class="!line.translatedLine ? 'border-red-300 bg-red-50 italic text-red-500' : 'border-gray-200 text-gray-700'"
                                       class="text-sm p-2 rounded-lg border">
                                        <span x-text="line?.translatedLine || 'No translation text'"></span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </li>
                </template>
            </ul>

            <!-- No results message -->
            <div class="text-center py-8" x-show="glossary?.details?.relatedLines?.length === 0">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                          stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No matching lines</h3>
            </div>
        </div>
    </div>
</div>
</body>
</html>